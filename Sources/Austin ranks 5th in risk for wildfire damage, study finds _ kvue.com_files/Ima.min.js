this.akamai=this.akamai||{},this.akamai.amp=this.akamai.amp||{},this.akamai.amp.ima=function(e){"use strict";var t=function(){function e(){babelHelpers.classCallCheck(this,e)}return babelHelpers.createClass(e,null,[{key:"INITIALIZED",get:function(){return"ima/initialize"}},{key:"ADD_OVERLAY",get:function(){return"ima/addOverlay"}},{key:"REMOVE_OVERLAY",get:function(){return"ima/removeOverlay"}}]),e}(),a=function(e){function a(t){var i;return babelHelpers.classCallCheck(this,a),i=e.call(this,t)||this,i.configurationName="imaoverlay",i.durationTimer=null,i.intervalTimer=null,i.delayTimer=null,i}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"defaults",get:function(){return{adTagUrl:null,duration:15,interval:30,delay:30}}},{key:"stop",value:function(){this.facade.player.timers.clearTimeout(this.durationTimer),this.facade.player.timers.clearTimeout(this.delayTimer),this.facade.player.timers.clearTimeout(this.intervalTimer)}},{key:"play",value:function(){var e=this;this.stop(),this.delayTimer=this.facade.player.timers.setTimeout(function(){return e.requestAd()},1e3*this.value.delay)}},{key:"requestAd",value:function(){var e;e=this.getValue("adTagUrl"),null!=e&&(e=e.replace("[timestamp]",(new Date).getTime()),e=e.replace("__random-number__",(new Date).getTime())),Utils.request({url:e,withCredentials:!0}).then(this.vastLoadHandler.bind(this)).catch(this.error.bind(this))}},{key:"vastLoadHandler",value:function(e){var t,a,i,n,s,r,o;if(o=e.target.responseXML,null!=o)try{t=o.querySelector("NonLinear"),null!=t?(r=null!=o.querySelector("Impression")?o.querySelector("Impression").textContent:"",i=null!=o.querySelector("Tracking[event=creativeView]")?o.querySelector("Tracking[event=creativeView]").textContent:"",a=null!=t.querySelector("NonLinearClickThrough")?t.querySelector("NonLinearClickThrough").textContent:"",s={src:t.querySelector("StaticResource").textContent,width:t.getAttribute("width"),height:t.getAttribute("height"),tracking:[r,i],href:a},this.displayAd(s)):this.error("No overlay was returned")}catch(e){n=e,this.error(n)}}},{key:"error",value:function(e){this.facade.logger.error("[AMP IMA OVERLAY ERROR]",e),this.stop()}},{key:"displayAd",value:function(e){var a=this;this.sendNotification(t.ADD_OVERLAY,e),this.durationTimer=this.facade.player.timers.setTimeout(function(){return a.sendNotification(t.REMOVE_OVERLAY),a.intervalTimer=a.facade.player.timers.setTimeout(function(){return a.requestAd()},1e3*a.value.interval)},1e3*this.value.duration)}}],[{key:"NAME",get:function(){return"IMAOveralyProxy"}}]),a}(akamai.amp.DataBoundConfigurationProxy),i=akamai.amp.Notifications,n=akamai.amp.ads.AdNotifications,s=akamai.amp.Utils,r=function(e){function t(a){var i;return babelHelpers.classCallCheck(this,t),i=e.call(this,a)||this,i.intervals=[],i.partner="ima",i.key="ima",i.adDisplayContainer=null,i.adDisplayContainerInitialized=!1,i.adsLoader=null,i.adsRenderingSettings=null,i.adsManagerLoaded=!1,i.adsManager=null,i.cuepoints=null,i.playWhenLoaded=!1,i.contentHasEnded=!1,i.adTagUrl=null,i.viewMode=null,i.playbackCore=null,i.adVO=i.createDefaultAdVO(),i.listeners={loadedmetadata:i.onLoadedMetadata.bind(babelHelpers.assertThisInitialized(i))},i.containerLoadingMaxRetry=1e3,i.containerLoadingRetryDelay=1,i}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"defaults",get:function(){return{adTagUrl:null,overlay:null,width:null,height:null,maxBitrate:-1,ppid:null,autoPlayAdBreaks:null,companions:null,logEventsEnabled:!1,adsRenderingSettings:null}}},{key:"setEnabled",value:function(e){var a;return babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setEnabled",this).call(this,e),e===!1&&(null!=(a=this.adsManager)&&"function"==typeof a.destroy&&a.destroy(),this.getInProgress()&&this.contentPlay()),e}},{key:"onLoadedMetadata",value:function(e){this.canPlay()&&this.playWhenLoaded===!0&&this.startAd()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e,t,a=s.isAndroid()&&s.isChrome();this.viewMode=google.ima.ViewMode.NORMAL,window.addEventListener("resize",this.resize.bind(this)),null!=this.config.vpaidAllowed&&google.ima.settings.setVpaidAllowed(this.config.vpaidAllowed),null!=this.config.vpaidMode&&null!=(e=google.ima.ImaSdkSettings.VpaidMode[this.config.vpaidMode.toUpperCase()])&&google.ima.settings.setVpaidMode(e),null!=this.config.disableFlashAds&&google.ima.settings.setDisableFlashAds(this.config.disableFlashAds),((null!=(t=s.getIOSversion())?t[0]:void 0)>=10||a)&&this.facade.player.getConfig().playsinline!==!1&&google.ima.settings.setDisableCustomPlaybackForIOS10Plus(this.config.disableCustomPlaybackForIOS10Plus!==!1),this.adDisplayContainer=this.createPlugin(),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.autoplay=this.getAutoplay(),null!=this.autoplay&&this.adsLoader.getSettings().setAutoPlayAdBreaks(this.autoplay),this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded.bind(this),!1),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this),!1)}},{key:"createPlugin",value:function(){return new google.ima.AdDisplayContainer(this.getContainer())}},{key:"engage",value:function(){var e,a;this.getEnabled()!==!1&&(babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"engage",this).call(this),(this.adsManagerLoaded===!0&&this.contentHasEnded===!1||this.contentHasEnded===!0&&"postroll"===(null!=(e=this.adVO)?e.type:void 0))&&null!=(a=this.adsManager)&&"function"==typeof a.destroy&&a.destroy(),this.adsManagerLoaded=!1,this.contentHasEnded=!1,this.adsManagerLoaded=!1,this.playWhenLoaded=!1)}},{key:"setVolume",value:function(e){var t;return null!=(t=this.adsManager)&&(t.setVolume(e),this.isLiveMidroll===!0&&(this.getMediaElement().volume=0)),e}},{key:"getVolume",value:function(){var e;return null!=(e=this.adsManager)?e.getVolume():void 0}},{key:"getAutoplay",value:function(){var e=this.facade.player;return(!e.media||!e.media.startTime)&&this.getValue("autoPlayAdBreaks")}},{key:"requestAd",value:function(){var e,a,i,n,s,r,o,l=this;if(babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"requestAd",this).call(this),a=this.getDimensions(),o=a.width,i=a.height,e=new google.ima.AdsRequest,this.adTagUrl=this.getValue("adTagUrl"),"object"===babelHelpers.typeof(this.adTagUrl)&&(this.adTagUrl=this.buildAdTagUrl(this.adTagUrl)),e.adTagUrl=this.adTagUrl,null==e.adsResponse&&null==e.adTagUrl)return void this.onAdError("No valid adTagUrl or adsResponse provided.");e.linearAdSlotWidth=o,e.linearAdSlotHeight=i,e.nonLinearAdSlotWidth=(null!=(n=this.value.overlay)?n.width:void 0)||o,e.nonLinearAdSlotHeight=(null!=(s=this.value.overlay)?s.height:void 0)||i,r=this.adsLoader.getSettings(),null!=this.config.ppid&&r.setPpid(this.getValue("ppid"));var d={adsRequest:e,adsLoader:this.adsLoader,adsRenderingSettings:this.adsRenderingSettings,adDisplayContainer:this.adDisplayContainer},h=akamai.amp.ads.AdRequest.create(e,"ima",this.getData(),d);Promise.resolve(h).then(function(e){var t=l.getValue("adsResponse");return null!=t&&""!==t?akamai.amp.Utils.requestText(t).then(function(t){return e.request.adsResponse=t,e}):e}).then(this.processAdRequest).then(function(e){return l.adsLoader.requestAds(e.request)})}},{key:"requestOverlay",value:function(){var e,t;t=this.value.overlay,null!=t&&(e=new google.ima.AdsRequest,e.adTagUrl=t.adTagUrl,e.nonLinearAdSlotWidth=t.width||300,e.nonLinearAdSlotHeight=t.height||50,this.adsLoader.requestAds(e))}},{key:"start",value:function(){var e,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return null==this.adDisplayContainer&&this.containerLoadingRetryDelay<this.containerLoadingMaxRetry?(this.facade.player.timers.setTimeout(this.start.bind(this,a),this.containerLoadingRetryDelay*=10),void this.facade.logger.warn("[AMP IMA]","Could not initialize ad container, Retrying in ".concat(this.containerLoadingRetryDelay,"ms"),this.adDisplayContainer)):(a===!0?(this.playbackCore=this.facade.player.retrieveProxy(akamai.amp.PlayerProxy.NAME).getActivePlaybackCore(),e=this.getMediaElement(),e.once("loadedmetadata",this.listeners.loadedmetadata),this.playbackCore.setEnabled(!1),this.facade.isFullscreenDevice()?this.playbackCore.load():e.load()):this.engage(),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"start",this).call(this)!==!1&&(this.isLiveMidroll=a===!1&&"live"===this.facade.player.mediaProxy.getTemporalType(),this.adDisplayContainerInitialized!==!0&&(this.adDisplayContainer.initialize(),this.adDisplayContainerInitialized=!0),void(this.canPlay()===!0&&a===!0?this.startAd():(this.playWhenLoaded=!0,this.requestAd()))))}},{key:"canPlay",value:function(){return this.adsManagerLoaded===!0}},{key:"getType",value:function(e){return 0===e?"preroll":e===-1?"postroll":"midroll"}},{key:"createAdVO",value:function(e){var t,a,i;return t=e.isLinear(),a=e.getAdPodInfo().getPodIndex(),i=t?this.getType(a):"overlay",akamai.amp.Ad.create(e.getAdId(),e.getAdId(),e.getDuration(),a,i,"ima",null,null,this.adTagUrl,e,e.getAdPodInfo().getTotalAds(),e.getDuration()-this.adsManager.getRemainingTime())}},{key:"startAd",value:function(){this.playWhenLoaded=!1;try{null==this.viewMode&&(this.viewMode=google.ima.ViewMode.NORMAL),this.adsManager.init(this.facade.player.getViewComponent().clientWidth,this.facade.player.getViewComponent().clientHeight,this.viewMode),(this.autoplay!==!1||this.cuePoints&&0===this.cuePoints.length)&&this.adsManager.start()}catch(e){this.error(e)}}},{key:"getViewMode",value:function(){return this.facade.player.displayState==akamai.amp.DisplayState.FULL_SCREEN?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL}},{key:"resize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.facade.player.displayState,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getDimensions(),a=this.viewMode;e===akamai.amp.DisplayState.FULL_SCREEN?a=google.ima.ViewMode.FULLSCREEN:e===akamai.amp.DisplayState.NORMAL&&(a=google.ima.ViewMode.NORMAL),a==this.viewMode&&null!=this.dimensions&&this.dimensions.width===t.width&&this.dimensions.height===t.height||(this.dimensions=t,this.viewMode=a,null!=this.adsManager&&this.adsManager.resize(this.dimensions.width,this.dimensions.height,this.viewMode))}},{key:"onAdBreakReady",value:function(e){var t=this,a=function(){t.adsManager.start()};if(this.autoplay!==!1)a();else{var i=akamai.amp.Ad.create(null,null,0,0,this.getType(e.getAdData().adBreakTime),"ima");this.processAdBreak(i).then(function(e){if("midroll"===i.type&&t.getMediaElement().readyState<2){var n=t.facade.player.timers;return void t.getMediaElement().once("playing",n.setTimeout.bind(n,a,100))}null!=e?a():"postroll"===i.type&&t.endBreak()})}}},{key:"onAdsManagerLoaded",value:function(e){var t,a,s=this;this.adsRenderingSettings.bitrate=this.getValue("maxBitrate"),this.adsRenderingSettings.autoAlign=!0,this.adsRenderingSettings.useStyledNonLinearAds=!0;var r=this.getValue("adsRenderingSettings");null!=r&&Object.entries(r).forEach(function(e){s.adsRenderingSettings[e[0]]=e[1]}),null!=(a=this.adsManager)&&"function"==typeof a.destroy&&a.destroy(),this.adsManager=e.getAdsManager(this.facade.player.mediaElement,this.adsRenderingSettings),this.sendNotification(n.AD_MANAGER_LOADED,{adManager:this.adsManager,viewMode:this.getViewMode(),adContainer:this.getContainer()}),this.adsManagerLoaded=!0,this.cuePoints=this.adsManager.getCuePoints(),this.setCues(this.cuePoints),this.cuePoints.indexOf(-1)!==-1&&this.sendNotification(i.HAS_POST_CONTENT,!0),t=this.onAdEvent.bind(this),this.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.contentPause.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.contentPlay.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY,this.onAdBreakReady.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,this.onAdResumed.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,this.onAdPaused.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,this.onAdClick.bind(this)),this.adsManager.addEventListener(google.ima.AdEvent.Type.IMPRESSION,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.MIDPOINT,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.AD_METADATA,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.INTERACTION,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.USER_CLOSE,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.VOLUME_CHANGED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.VOLUME_MUTED,t),this.adsManager.addEventListener(google.ima.AdEvent.Type.LOG,t),this.sendNotification(n.REQUEST_COMPLETE,{pods:this.cuePoints}),this.sendNotification(n.RESPONSE,{pods:this.cuePoints,response:e,adsManager:this.adsManager}),this.canPlay()&&this.playWhenLoaded===!0&&this.startAd()}},{key:"onAdClick",value:function(e){return(null!=e?e.getAd().isLinear():void 0)===!1?void this.facade.player.sendNotification(i.PAUSE):(this.getPaused()||this.pause(),void this.sendNotification(n.AD_CLICKED,this.adVO))}},{key:"onAdPaused",value:function(e){this.setPaused(!0),this.facade.player.sendNotification(i.CHANGE_PLAY_STATE,akamai.amp.PlayState.PAUSED),this.facade.player.sendNotification(i.CHANGE_ACTIVE_STATE,akamai.amp.ActiveState.ACTIVE),this.sendNotification(n.AD_PAUSED,this.adVO)}},{key:"onAdResumed",value:function(e){this.setPaused(!1),this.facade.player.sendNotification(i.CHANGE_PLAY_STATE,akamai.amp.PlayState.PLAYING)}},{key:"onAdEvent",value:function(e){var t,a,s,r,o,l,d,h;switch(t=e.getAd(),null!=this.adVO&&(null!=t&&(t.wrapperAdIds="function"==typeof t.getWrapperAdIds?t.getWrapperAdIds():void 0,t.wrapperAdSystems="function"==typeof t.getWrapperAdSystems?t.getWrapperAdSystems():void 0),this.adVO.metadata=t),e.type){case google.ima.AdEvent.Type.IMPRESSION:this.adVO=this.createAdVO(t),this.sendNotification(n.IMPRESSION,this.adVO);break;case google.ima.AdEvent.Type.LOADED:this.adVO=this.createAdVO(t),t.isLinear()?this.getInProgress()&&"preroll"===this.adVO.type&&this.load(this.adVO):(this.facade.player.sendNotification(i.ADD_APPLICATION_STATE,"ad-overlaymode"),this.contentPlay());break;case google.ima.AdEvent.Type.STARTED:t.isLinear()&&(!this.getInProgress()&&this.adVO&&(this.startBreak(),this.engageAds(),this.load(this.adVO)),this.adVO.position=t.getAdPodInfo().getAdPosition(),this.sendNotification(n.AD_STARTED,this.adVO),this.intervals.push(this.facade.player.timers.setInterval(this.onAdTimeUpdate.bind(this),67)),this.sendNotification(n.AD_PLAY,this.adVO),this.facade.player.playState!==akamai.amp.PlayState.PLAYING?this.facade.player.sendNotification(i.CHANGE_PLAY_STATE,akamai.amp.PlayState.PLAYING):this.sendNotification(n.AD_PLAYING,this.adVO));try{r="companions"in this.config?this.config.companions:[],s=[];for(l=0,d=r.length;l<d;l++)a=r[l],s=s.concat(t.getCompanionAds(a.width,a.height));(null!=s?s.length:void 0)>0&&this.setCompanions(s)}catch(e){o=e,this.facade.logger.error("[AMP IMA ERROR]","Could not retrieve companion ads:",o)}break;case google.ima.AdEvent.Type.COMPLETE:t.isLinear()&&this.sendNotification(n.AD_ENDED,this.adVO),this.sendNotification(i.DISPATCH_EVENT,e);break;case google.ima.AdEvent.Type.FIRST_QUARTILE:this.sendNotification(n.FIRST_QUARTILE,this.adVO);break;case google.ima.AdEvent.Type.MIDPOINT:this.sendNotification(n.MIDPOINT,this.adVO);break;case google.ima.AdEvent.Type.THIRD_QUARTILE:this.sendNotification(n.THIRD_QUARTILE,this.adVO);break;case google.ima.AdEvent.Type.LOG:this.facade.player.retrieveProxy(akamai.amp.ApplicationStateProxy.NAME).getEnded()===!0&&null!=(null!=(h=e.getAdData())?h.adError:void 0)&&(this.forceBreakEnd=!0),this.getValue("logEventsEnabled")===!0&&this.sendNotification(n.LOG,this.adVO);break;case google.ima.AdEvent.Type.SKIPPED:this.sendNotification(n.SKIPPED,this.adVO);break;case google.ima.AdEvent.Type.ALL_ADS_COMPLETED:var c=this.appState.hasPostContent,u=this.appState.ended;u!==!0&&c===!0&&(this.forceBreakEnd=!0,this.sendNotification(i.HAS_POST_CONTENT,!1)),this.getInProgress()!==!0&&this.forceBreakEnd!==!0||(this.forceBreakEnd=!1,this.endBreak()),this.sendNotification(i.DISPATCH_EVENT,e);break;default:this.sendNotification(i.DISPATCH_EVENT,e)}}},{key:"load",value:function(e){this.resize(),this.sendNotification(n.AD_LOADED,e),this.sendNotification(n.AD_DURATION_CHANGE,e),this.setVolume(this.facade.player.retrieveProxy(akamai.amp.ApplicationStateProxy.NAME).getVolume())}},{key:"getDimensions",value:function(){var e;return e=this.facade.player.getViewComponent(),{width:e.clientWidth,height:e.clientHeight}}},{key:"onAdTimeUpdate",value:function(e){var t=0,a=this.adsManager.getRemainingTime();a<0||(this.resize(),t=Math.max(this.adVO.duration-a,0),a=akamai.amp.Utils.clamp(a,0,this.adVO.duration),this.adVO.time=t,this.sendNotification(n.AD_TIME_UPDATE,t),this.sendNotification(n.AD_TIME_REMAINING,a))}},{key:"onAdError",value:function(e){var t;t=(null!=e&&"function"==typeof e.getError?e.getError():void 0)||e,this.error(t),this.contentPlay()}},{key:"play",value:function(){var e,a;babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"play",this).call(this);try{null!=(a=this.adsManager)&&a.resume(),this.sendNotification(n.AD_RESUME)}catch(t){e=t,this.facade.logger.error("[AMP IMA ERROR]","resume",e)}}},{key:"pause",value:function(){var e;if(babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"pause",this).call(this),null!=this.adsManager)try{this.adsManager.pause()}catch(t){e=t,this.facade.logger.error("[AMP IMA ERROR]","pause",e)}else this.playWhenLoaded=!1}},{key:"clearIntervals",value:function(){var e,t,a,i;for(i=this.intervals,e=0,a=i.length;e<a;e++)t=i[e],this.facade.player.timers.clearInterval(t);this.intervals=[]}},{key:"breakEnd",value:function(){var e;this.clearIntervals(),babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"breakEnd",this).call(this),e=this.facade.retrieveProxy(a.NAME),null!=e&&e.play()}},{key:"setCompanions",value:function(e){var a,i,n,s,r;for(i=[],n=0,s=e.length;n<s;n++)a=e[n],i.push({data:a.getContent(),type:null!=(r=a.getContentType())?r.toLowerCase():void 0,width:a.getWidth(),height:a.getHeight(),metadata:a});return babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"setCompanions",this).call(this,i),e}},{key:"contentPause",value:function(){var e,a=this;return e=["pause","waiting","playing","ended","durationchange","error"],this.facade.player.retrieveProxy(akamai.amp.ApplicationStateProxy.NAME).getSeeking()===!1?e.push("seeked"):this.getMediaElement().once("seeked",function(){a.sendNotification(i.DISABLE_VIDEO_EVENTS,["seeked"])}),this.sendNotification(i.DISABLE_VIDEO_EVENTS,e),this.isLiveMidroll===!0?void(this.getMediaElement().volume=0):void babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"contentPause",this).call(this)}},{key:"contentPlay",value:function(){var e,a;if(this.getInProgress()===!0&&this.endBreak(),this.sendNotification(i.ENABLE_VIDEO_EVENTS,["pause","seeked","waiting","playing","ended","durationchange","error"]),"postroll"!==(null!=(e=this.adVO)?e.type:void 0)){if(this.isLiveMidroll===!0){if(this.getMediaElement().volume=this.facade.player.retrieveProxy(akamai.amp.ApplicationStateProxy.NAME).getVolume(),"ipad"!==akamai.amp.Utils.getDevice())return;this.getMediaElement().load()}babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"contentPlay",this).call(this),"midroll"===(null!=(a=this.adVO)?a.type:void 0)&&"desktop"===akamai.amp.Utils.getDevice()&&this.facade.player.setCurrentTime(Math.floor(this.facade.player.getCurrentTime()))}}},{key:"contentEnded",value:function(){var e,t;this.contentHasEnded=!0;try{null!=(t=this.adsLoader)&&"function"==typeof t.contentComplete&&t.contentComplete()}catch(t){e=t,this.facade.logger.error("[AMP IMA ERROR]","contentComplete",e)}}},{key:"terminateAd",value:function(){var e,t;try{null!=(t=this.adsManager)&&t.stop()}catch(t){e=t,this.facade.logger.error("[AMP IMA ERROR]","terminateAd",e)}"postrol"===this.adVO.type&&this.sendNotification(i.HAS_POST_CONTENT,!1),this.endBreak(),this.contentPlay()}},{key:"terminateAllAds",value:function(){var e,t;try{null!=(t=this.adsManager)&&t.destroy()}catch(t){e=t,this.facade.logger.error("[AMP IMA ERROR]","terminateAllAds",e)}this.sendNotification(i.HAS_POST_CONTENT,!1),this.endBreak(),this.contentPlay()}},{key:"destroy",value:function(){var e;this.clearIntervals(),null!=(e=this.adsManager)&&"function"==typeof e.destroy&&e.destroy()}},{key:"buildAdTagUrl",value:function(e){var t;return t=e.base||"//pubads.g.doubleclick.net/gampad/ads",t+="?"+this.encodeAdTagParams(e.params)}},{key:"encodeAdTagParams",value:function(e){var t,a,i;t=[];for(a in e)i=e[a],"object"===babelHelpers.typeof(i)&&(i=encodeURIComponent(this.encodeAdTagParams(i))),t.push("".concat(a,"=").concat(i));return t.join("&")}}],[{key:"NAME",get:function(){return akamai.amp.ads.AdProxy.NAME}}]),t}(akamai.amp.ads.AdProxy),o=function(e){function t(a){return babelHelpers.classCallCheck(this,t),e.call(this,a)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"createPlugin",value:function(){var e,t,a;return e=this.getContainer(),akamai.amp.Utils.isIPhone()&&(null!=(t=akamai.amp.Utils.getIOSversion())?t[0]:void 0)<10?new google.ima.AdDisplayContainer(e,this.facade.player.getMediaElement(),e):((null!=(a=akamai.amp.Utils.getIOSversion())?a[0]:void 0)>=10&&(this.facade.player.getMediaElement().playsInline=null==this.facade.player.getConfig().playsinline||this.facade.player.getConfig().playsinline),new google.ima.AdDisplayContainer(e,this.facade.player.getMediaElement()))}},{key:"engage",value:function(e){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"engage",this).call(this,e),this.sendNotification(akamai.amp.Notifications.DISABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"])}},{key:"reset",value:function(e){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"reset",this).call(this,e),this.sendNotification(akamai.amp.Notifications.ENABLE_VIDEO_EVENTS,["paused","ended","durationchange","error"])}},{key:"breakStart",value:function(){this.playbackCore=this.facade.player.retrieveProxy(akamai.amp.PlayerProxy.NAME).getActivePlaybackCore(),this.playbackCore.setEnabled(!1),this.setInProgress(!0)}},{key:"breakEnd",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(t.prototype),"breakEnd",this).call(this),this.playbackCore.setEnabled(!0)}}],[{key:"NAME",get:function(){return r.NAME}}]),t}(r),l=function(e){function t(){return babelHelpers.classCallCheck(this,t),e.call(this)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"execute",value:function(e){this.facade.sendNotification(akamai.amp.Notifications.ADD_APPLICATION_STATE,"ad-overlay-mode")}}]),t}(puremvc.SimpleCommand),d=function(e){function t(){return babelHelpers.classCallCheck(this,t),e.call(this)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"execute",value:function(e){var t=this.facade.retrieveProxy(a.NAME);t.stop(),this.facade.player.sendNotification(akamai.amp.Notifications.REMOVE_APPLICATION_STATE,"ad-overlay-mode")}}]),t}(puremvc.SimpleCommand),h=function(e){function a(){var t;return babelHelpers.classCallCheck(this,a),t=e.call(this)||this,t.componentName="ad-overlay",t.anchor=null,t.image=null,t.tracker=null,t.tracker2=null,t.closeButton=null,t.closeText=null,t}return babelHelpers.inherits(a,e),babelHelpers.createClass(a,[{key:"onRegister",value:function(){var e=this;babelHelpers.get(babelHelpers.getPrototypeOf(a.prototype),"onRegister",this).call(this),this.anchor=this.create("ad-overlay-anchor"),this.anchor.target="_blank",this.image=this.create("ad-overlay-img",this.anchor,"img"),this.tracker=this.create(),this.tracker.width=0,this.tracker.height=0,this.tracker2=this.create(null,this,"img"),this.tracker2.width=0,this.tracker2.height=0,this.closeButton=this.create("ad-close-button",this.anchor),this.closeButton.onclick=function(a){return a.stopImmediatePropagation(),e.sendNotification(t.REMOVE_OVERLAY),!1},this.closeText=this.createText("ad-close-text","x",this.closeButton)}},{key:"listNotificationInterests",value:function(){return[t.ADD_OVERLAY,t.REMOVE_OVERLAY]}},{key:"handleNotification",value:function(e){var a;switch(e.getName()){case t.ADD_OVERLAY:a=e.getBody(),this.image.src=a.src,this.anchor.href=a.href,this.tracker.src=a.tracking[0],this.tracker2.src=a.tracking[1]}}}]),a}(akamai.amp.OverlayMediator),c=function(e){function t(){return babelHelpers.classCallCheck(this,t),e.call(this)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"execute",value:function(e){var t=this;this.facade.player.timers.setTimeout(function(){return t.facade.retrieveProxy(r.NAME).ready()},10)}}]),t}(puremvc.SimpleCommand),u=function(e){function t(){return babelHelpers.classCallCheck(this,t),e.call(this)||this}return babelHelpers.inherits(t,e),babelHelpers.createClass(t,[{key:"execute",value:function(e){this.facade.retrieveProxy(r.NAME).resize(e.getBody())}}]),t}(puremvc.SimpleCommand),g=function(e){function i(){return babelHelpers.classCallCheck(this,i),e.call(this)||this}return babelHelpers.inherits(i,e),babelHelpers.createClass(i,[{key:"moduleName",get:function(){return"ima"}},{key:"adsManager",get:function(){return this.proxy.adsManager}},{key:"adsRenderingSettings",get:function(){return this.proxy.adsRenderingSettings}},{key:"adsLoader",get:function(){return this.proxy.adsLoader}},{key:"adDisplayContainer",get:function(){return this.proxy.adDisplayContainer}},{key:"createFullscreenProxy",value:function(){return new o(this.config)}},{key:"createProxy",value:function(){return new r(this.config)}},{key:"isFullscreenDevice",value:function(){var e=navigator.userAgent;return this.config.fullscreen===!0||akamai.amp.Utils.isFullscreenDevice()||/Android 4\.[0-1]/.test(e)||/CrKey/.test(e)}},{key:"createModel",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"createModel",this).call(this),null!=this.config.overlay&&this.registerProxy(new a(this.config.overlay))}},{key:"createController",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"createController",this).call(this),null!=this.config.overlay&&(this.registerCommand(t.ADD_OVERLAY,l),this.registerCommand(t.REMOVE_OVERLAY,d)),this.registerCommand(akamai.amp.Notifications.READY,c),this.registerCommand(akamai.amp.Notifications.CHANGE_ACTIVE_STATE,u)}},{key:"createView",value:function(){babelHelpers.get(babelHelpers.getPrototypeOf(i.prototype),"createView",this).call(this),null!=this.config.overlay&&this.registerMediator(new h)}}]),i}(akamai.amp.ads.AdPlugin);return akamai.amp.AMP.registerPlugin("ima","html",akamai.amp.Plugin.createPureMVCFactory(g)),e.IMA=g,Object.defineProperty(e,"__esModule",{value:!0}),e}({});