define("ad",["module","page","utils","bem","jquery","universal-ad","jquery-utils"],function(e,h,w,b,v){const y={name:e.id,class:"."+e.id};w.broadcast(y.name,"loaded"),w.createModuleNoJQ(y.name,function(o){const a=this,i=new b(o,y.name),n=(this.el=o,this.module=y,this.delay=1e3*parseInt(o.dataset.delay),this.lazy="true"===o.dataset.lazy,this.refresher=null,this.isRefresh=!1,this.refreshCount=0,this.refreshObserver=null,this.init=function(){const t=e=>{window.setTimeout(function(){window.googletag&&window.googletag.pubads?e():t(e)},200)};t(()=>{a.broadcast("init",{position:o.dataset.position}),g();var e=d(),t=window.localStorage.getItem("ope_fpid");0<e&&n("articleNumber",e),n("refresh",!1),null!==t&&n("1plusx_ppid",t),a.broadcast("setup",{position:o.dataset.position,id:a.id,delay:a.delay}),w.listen("_gpt","slotRenderEnded",function(e,t,i){i.request.domId===a.id&&f(i)}),p(function(){c()})}),a.broadcast("ready")},(e,t)=>{var i=w.dashesToCamel("targeting-"+e),s="data-targeting-"+e;null==t?(a.broadcast("removingTargeting",{position:o.dataset.position,target:e}),o.removeAttribute(s)):o.dataset[i]!==t.toString()?(a.broadcast("settingTargeting",{position:o.dataset.position,target:e,value:t.toString()}),o.dataset[i]=t.toString()):a.broadcast("ignoringExistingTargeting",{position:o.dataset.position,target:e,value:t.toString()})});function s(e){a.refresher&&(e||a.broadcast("refreshStopped",{position:o.dataset.position}),window.clearTimeout(a.refresher),window.clearInterval(a.refreshCountdown),a.refresher=null)}function r(){var e;"true"===o.dataset.refreshEnabled&&(e=parseInt(o.dataset.refreshInterval),s(!0),a.refresher=window.setTimeout(()=>{a.refreshCount++,a.isRefresh=!0,n("refresh",!0),function e(){document.hidden?(a.broadcast("refreshBlocked",{position:o.dataset.position}),v(document).one("visibilitychange",()=>{a.broadcast("refreshUnblocked",{position:o.dataset.position}),e()})):c()}()},1e3*e),a.refreshRemaining=e,a.refreshCountdown=window.setInterval(()=>{a.refreshRemaining--,a.refreshRemaining<1?window.clearInterval(a.refreshCountdown):a.broadcast("refreshCountdown",{position:o.dataset.position,remaining:a.refreshRemaining})},1e3),a.broadcast("refreshRestarted",{position:o.dataset.position}),a.broadcast("refreshCountdown",{position:o.dataset.position,remaining:a.refreshRemaining}))}const d=()=>{var e=document.querySelectorAll(".grid__section");const i=o.closest(".grid__section");let s=0,a=0;return e.forEach((e,t)=>{e.querySelector(".article")&&(s++,e===i)&&(a=s)}),a},l=()=>new Promise(e=>{a.broadcast("startingA9Bidding",{position:o.dataset.position});var t=[];"true"===o.dataset.outstreamEnabled?t.push({slotID:a.id,slotName:o.dataset.path,mediaType:"multi-format",multiFormatProperties:{display:{sizes:JSON.parse(o.dataset.sizes)},video:{sizes:JSON.parse(o.dataset.outstreamSizes)}}}):t.push({slotID:a.id,slotName:o.dataset.path,sizes:JSON.parse(o.dataset.sizes)}),window.apstag.fetchBids({slots:t},function(i){0<i.length?(a.broadcast("receivedA9Bids",{bids:i,position:o.dataset.position}),window.googletag&&window.googletag.cmd&&window.googletag.cmd.push(function(){a.broadcast("refreshing",{position:o.dataset.position}),["amznbid","amzniid","amznsz","amznp"].forEach(e=>{var t=i[0][e];n(e,t)})})):window.googletag&&window.googletag.cmd&&window.googletag.cmd.push(function(){a.broadcast("noAmazonBids",{position:o.dataset.position}),a.broadcast("refreshing",{position:o.dataset.position})}),e()})}),u=()=>{let s=!1;return new Promise(i=>{a.broadcast("gettingOnePlusXProfile",{position:o.dataset.position}),window.tegna.getOnePlusXProfileData((e,t)=>{a.broadcast("receivedOnePlusXProfileData",{segments:e,topics:t,position:o.dataset.position}),n("1plusX",e),n("opectx",t),s=!0,i()}),setTimeout(function(){s||(a.broadcast("timedOutOnePlusXProfileData",{position:o.dataset.position}),i())},1e3)})},c=()=>{var e=[{name:"a9",enabled:"apstag"in window&&"fetchBids"in window.apstag,ready:"apstag"in window&&"fetchBids"in window.apstag,request:l},{name:"oneplusxprofile",enabled:"getOnePlusXProfileData"in window.tegna,ready:"getOnePlusXProfileData"in window.tegna,request:u}];let t=[];e.forEach(e=>{e.enabled&&e.ready?t.push(e.request()):a.broadcast(e.name+"BiddingSkipped",{name:e.name,enabled:e.enabled,ready:e.ready})}),Promise.allSettled(t).then(()=>{a.broadcast("refreshing",{position:o.dataset.position});t=(()=>{var e=o.closest(".grid__section");if(e){e=e.getElementsByClassName("article");if(0<e.length){e=e[0].dataset["iabCategoryId-2.2"];if(null!==e)return e}}return null})(),e=h.model["iabCategoryId-2.2"]||((e=document.querySelector('.article[data-module="article"]'))?e.dataset["iabCategoryId-2.2"]:null);var e,t=t||e||null;null!==t&&n("content_cat",t),n("refresh_count",a.refreshCount),n("refresh_delay",parseInt(o.dataset.refreshInterval)),window.tegna.ads.refresh(a.id)})},p=i=>{a.lazy?w.observeIntersections(o,(e,t)=>{e.isIntersecting&&(t.unobserve(e.target),null!==a.timeout)&&(window.clearTimeout(a.timeout),i())}):0<a.delay?(a.timeout=window.setTimeout(function(){a.timeout=null,i()},a.delay),w.observeIntersections(o,(e,t)=>{e.isIntersecting&&(t.unobserve(e.target),null!==a.timeout)&&(window.clearTimeout(a.timeout),i())})):i()},g=()=>{var t=o.dataset.position;if(document.getElementById(t)){let e=1;for(;null!==document.getElementById(t+"_"+e);)e++;t+="_"+e}a.id=t,o.firstElementChild.setAttribute("id",a.id)},t=e=>{"desktop"===document.getElementsByClassName("page")[0].dataset.platform&&1080<=e&&i.selectElements("inner").setModifier("border",!1)},m=(e,t)=>{t<3&&!1===e&&(i.selectElements("inner").setModifier("border",!1),i.selectElements("inner").setModifier("background",!1))},f=e=>{a.broadcast("received",{position:o.dataset.position,payload:e}),"true"===o.dataset.collapse&&e.response.isEmpty?a.el.style.display="none":("true"===o.dataset.refreshEnabled&&(a.refreshObserver?r():w.observeIntersections(o,(e,t)=>{a.refreshObserver=t,(e.isIntersectingThreshold&&!a.viewable?(a.broadcast("viewable",{position:o.dataset.position}),r):(a.viewable=!1,a.broadcast("unviewable",{position:o.dataset.position}),s))()},{threshold:1})),t(e.response.size.width),m(e.response.isEmpty,e.response.size.width))}})});
//# sourceMappingURL=ad_9.14.14.js.map