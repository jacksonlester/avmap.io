!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="deb9c74a-93f6-4f9b-97dd-331786c37d88",e._sentryDebugIdIdentifier="sentry-dbid-deb9c74a-93f6-4f9b-97dd-331786c37d88")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2705],{44671:function(e,n,t){t.r(n);let o={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"CoralSectionContainer_contentResource",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"chorusId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"chorusUuid",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"globalId",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"permalink",storageKey:null},{alias:null,args:null,concreteType:"CommentsType",kind:"LinkedField",name:"comments",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"enabled",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"mode",storageKey:null}],storageKey:null}],type:"ContentResourceInterface",abstractKey:"__isContentResourceInterface"};o.hash="342a129697ecc3dde30b36315d86fc1c",n.default=o},32705:function(e,n,t){t.d(n,{Z:function(){return x}});var o,r=t(68705),a=t(84795),s=t(150),i=t(4093),l=t(84994),c=t(50229);t(96700);var d=t(35683),u=()=>{let e=null,{coralConfig:n}=(0,a.q)();if(!n)throw Error("missing coral config");let t=(0,l.aC)();if(t.userLoading||!t.viewer&&!t.user)return null;let o=t.viewer,r=t.user;if(o&&("BANNED"===o.status||"BANNED"===o.communityMembershipStatus?e=(0,d.jsxs)(d.Fragment,{children:["Your commenting account has been frozen, please contact"," ",(0,d.jsx)("a",{href:`mailto:${n.moderationEmail}`,children:n.moderationEmail})," ","for more information."]}):null===o.email?e=(0,d.jsxs)(d.Fragment,{children:["You're signed in, but you must"," ",(0,d.jsx)("a",{href:`/users/${encodeURIComponent(o.username)}/account`,children:"provide and verify your email address"})," ","before you can use the new commenting experience. If you have already provided and verified your email, please allow a couple of minutes for the changes to take effect and"," ",(0,d.jsx)("button",{className:c.F.text.singleLink,onClick:()=>location.reload(),children:"reload the page"}),"."]}):o.emailVerified||(e=(0,d.jsxs)(d.Fragment,{children:["You're signed in, but you must"," ",(0,d.jsx)("a",{href:"/resend_confirmation",children:"verify your email address"})," before you can use the new commenting experience. If you have already verified your email, please allow a couple of minutes for the changes to take effect and"," ",(0,d.jsx)("button",{className:c.F.text.singleLink,onClick:()=>location.reload(),children:"reload the page"}),"."]}))),r){let n;r.emailVerified||r.commentingName?r.emailVerified?r.commentingName||(n="add a commenting name"):n="verify your email address":n="verify your email address and add a commenting name",n?e=(0,d.jsxs)(d.Fragment,{children:["You're signed in, but you must"," ",(0,d.jsx)("a",{href:"/account/profile",children:n}),". If you have already done so, try ",(0,d.jsx)("a",{role:"button",href:"#",className:c.F.text.singleLink,onClick:()=>location.reload(),children:"reloading the page"}),". Your first few comments may be reviewed by a site moderator."]}):r.coral||(e=(0,d.jsxs)(d.Fragment,{children:["You're signed in, but it seems that you have an incomplete profile. Please check your"," ",(0,d.jsx)("a",{href:"/account/profile",children:"account profile page"}),"."]}))}return e?(0,d.jsx)("div",{className:(0,i.Z)("_1du8spn0",c.F.text.linkStyles),children:e}):null},m=t(3092),f=t(48192),h=t.n(f),g=t(66123),y=t(75076),p=t(7209),b=t(8447),C=t(45528);let w={"createComment.success":"comment","createCommentReply.success":"comment","editComment.success":"edit","reportComment.success":"report","createCommentReaction.success":"respect",showSharePopover:"share",setCommentsOrderBy:"set_sort_order",unmarkAll:"unmark_unread",jumpToNextUnseenComment:"z_key_next",setProfileTab:"set_profile_tab","ignoreUser.success":"ignore_user",copyPermalink:"copy_permalink"};class v{events=null;constructor(e,n){this.client=e,this.ssoConfig=n}handleOnLoginPrompt=()=>{this.client.emit({event:"authentication",authentication:{method:"sign in and join the conversation"}});let e=this.getIdentityAuthLink();window.location.href=e};getIdentityAuthLink=()=>{let{protocol:e,href:n,pathname:t,search:o}=window.location;if(this.ssoConfig?.ssoAuthDomain&&!this.ssoConfig.isPrimaryCommunity)return`${e}//${this.ssoConfig.ssoAuthDomain}/auth/sso?returnTo=${encodeURIComponent(n)}`;let r=encodeURIComponent(t+o+"#comments");return`/auth/login?returnPath=${r}`};handleOnAny=e=>{if(Array.isArray(e))return;let n=w[e];n&&this.client.emit({event:"coral_comment",coral_comment:{action:n}})};connect(e){this.events&&this.disconnect(),this.events=e,this.events.on("loginPrompt",this.handleOnLoginPrompt),this.events.onAny(this.handleOnAny)}disconnect(){this.events&&(this.events.off("loginPrompt",this.handleOnLoginPrompt),this.events.offAny(this.handleOnAny),this.events=null)}}var I=(0,s.n)(e=>{let{contentInit:n,domID:t,customScrollerID:o,onEmbedLoad:r,containerClassName:s,nodeId:c}=e,u=(0,g.useRef)(null),f=(0,g.useRef)(null),w=(0,g.useRef)(null),[I,k]=(0,g.useState)(!1),x=(0,l.aC)(),{coralConfig:_}=(0,a.q)(),{getCommentCount:S,isRefreshComplete:j}=(0,b.M)();if(!_)throw Error("missing coral config");let E=(0,p.z$)(),{appConfig:{deployEnv:F},communityConfig:{ssoAuthDomain:L,isPrimaryCommunity:R}}=(0,a.q)(),N=(0,y.w)({chorusId:n.chorusId,chorusUuid:n.chorusUuid,globalId:n.globalId}),A=(0,g.useCallback)(e=>{if(!_.origin||!n.comments.enabled)return;w.current=e;let a=new URL(n.permalink);n.permalink&&"production"!==F&&"staging"!==F&&(a.host=window.location.host,a.protocol=window.location.protocol),window.coralStoryId=N;let l=L?{ssoAuthDomain:L,isPrimaryCommunity:R}:void 0;f.current=E?new v(E,l):null,u.current=w.current.createStreamEmbed({id:t,rootURL:_.origin,storyID:N??void 0,storyURL:a.toString(),autoRender:!0,customCSSURL:"/_next/static/coral.a096833f5171c3f3aa4194e43e2b5f60.css".includes("://")?"/_next/static/coral.a096833f5171c3f3aa4194e43e2b5f60.css":`${location.origin}/_next/static/coral.a096833f5171c3f3aa4194e43e2b5f60.css`,customFontsCSSURL:"/_next/static/coral-rte.7b4a8f826ae9773c4c95a26b7b105f05.css".includes("://")?"/_next/static/coral-rte.7b4a8f826ae9773c4c95a26b7b105f05.css":`${location.origin}/_next/static/coral-rte.7b4a8f826ae9773c4c95a26b7b105f05.css`,containerClassName:(0,i.Z)(s,`rec-threshold-${_.commentRecThreshold}`),storyMode:"qa"===n.comments.mode?"QA":"COMMENTS",events:e=>{f.current?.connect(e)},customScrollContainer:o?document.getElementById(o):null}),window.CoralStreamEmbed=u.current,r&&r(u.current),k(!0)},[_.origin,_.commentRecThreshold,n.comments.enabled,n.comments.mode,n.permalink,F,N,L,R,E,t,s,o,r]),U=(0,g.useCallback)(()=>{if(!window.Coral){!function(e,n,t=1e3){let o=0,r=()=>{let a=e();if(!a){o+=1;let e="number"==typeof t?t:t(o);if(!e)return;setTimeout(r,e);return}n(a)};r()}(()=>window.Coral,e=>{A(e)});return}A(window.Coral)},[A]);return((0,g.useEffect)(()=>{j&&c&&(0,C.J)(c,S(c)||0)},[c,S,j]),(0,g.useEffect)(()=>{window.Coral&&!w.current&&A(window.Coral)},[A]),(0,g.useEffect)(()=>()=>{u.current&&(u.current.rendered?u.current.remove():(0,m.Tb)("Trying to remove Coral, while it was not rendered")),f.current?.disconnect(),f.current=null,u.current=null,w.current=null},[]),(0,g.useEffect)(()=>{!x.userLoading&&x.user?.coral&&u.current&&I&&u.current.login(x.user.coral)},[x.userLoading,x.user?.coral,I]),_.origin&&n.comments.enabled)?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("span",{style:{display:"none"},children:"Comments"}),(0,d.jsx)(h(),{src:`${_.origin}/assets/js/embed.js?v=${_.cacheFingerprint}`,onLoad:U,defer:!0})]}):null},{context:"CoralLoaderErrorBoundary"});t(46116);var k=(0,s.n)(e=>{let{coralConfig:n}=(0,a.q)();return n?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(u,{}),(0,d.jsx)("div",{id:e.coralId,className:"_7msvnx0"}),(0,d.jsx)(I,{contentInit:e.contentInit,domID:e.coralId,onEmbedLoad:e.onEmbedLoad,containerClassName:e.containerClassName,customScrollerID:e.customScrollerID,nodeId:e.nodeId})]}):null},{context:"CoralSectionErrorBoundary"}),x=e=>{let{contentResource:n,onEmbedLoad:a,containerClassName:s,customScrollerID:i,coralId:l}=e,c=(0,r.useFragment)((void 0!==o||(o=t(44671)).hash&&"342a129697ecc3dde30b36315d86fc1c"!==o.hash&&console.error("The definition of 'CoralSectionContainer_contentResource' appears to have changed. Run `relay-compiler` to update the generated files to receive the expected data."),o),n);if(!c)throw Error("CoralSectionContainer requires GraphQL data to be passed in.");let u={chorusId:c.chorusId,chorusUuid:c.chorusUuid,globalId:c.globalId,permalink:c.permalink,comments:c.comments};return(0,d.jsx)(k,{contentInit:u,onEmbedLoad:a,containerClassName:s,customScrollerID:i,coralId:l,nodeId:c.id})}}}]);