import"./iBzsvqRc.min.js";import{f as formatBlogPostDate}from"./chunks/D9SJKtsg.min.js";import{P as PAGE_SIZE}from"./BAOD6ZUh.min.js";import{W as WaymoElement}from"./DBBL1asN.min.js";import"./BJMSoeSN.min.js";import"./chunks/C6NDGylb.min.js";import"./xjGV_zMG.min.js";import"./chunks/6APPbRhI.min.js";import"./chunks/Cvr5WbqH.min.js";import"./chunks/CF8sV3Lr.min.js";import"./chunks/jaip2ZBL.min.js";import"./chunks/BZCoTZ8E.min.js";function parse_option(e,t){return typeof e<"u"?e:t}function create_object_array(e){const t=new Array(e);for(let s=0;s<e;s++)t[s]=create_object();return t}function get_keys(e){return Object.keys(e)}function create_object(){return Object.create(null)}function concat(e){return[].concat.apply([],e)}function sort_by_length_down(e,t){return t.length-e.length}function is_array(e){return e.constructor===Array}function is_string(e){return typeof e=="string"}function is_object(e){return typeof e=="object"}function is_function(e){return typeof e=="function"}function pipeline(e,t,s,i){if(e&&(t&&(e=replace(e,t)),this.matcher&&(e=replace(e,this.matcher)),this.stemmer&&e.length>1&&(e=replace(e,this.stemmer)),i&&e.length>1&&(e=collapse(e)),s||s==="")){const r=e.split(s);return this.filter?filter(r,this.filter):r}return e}const regex_whitespace=/[\p{Z}\p{S}\p{P}\p{C}]+/u;function init_filter(e){const t=create_object();for(let s=0,i=e.length;s<i;s++)t[e[s]]=1;return t}function init_stemmer_or_matcher(e,t){const s=get_keys(e),i=s.length,r=[];let n="",a=0;for(let h=0,l,c;h<i;h++)l=s[h],c=e[l],c?(r[a++]=regex(t?"(?!\\b)"+l+"(\\b|_)":l),r[a++]=c):n+=(n?"|":"")+l;return n&&(r[a++]=regex(t?"(?!\\b)("+n+")(\\b|_)":"("+n+")"),r[a]=""),r}function replace(e,t){for(let s=0,i=t.length;s<i&&(e=e.replace(t[s],t[s+1]),!!e);s+=2);return e}function regex(e){return new RegExp(e,"g")}function collapse(e){let t="",s="";for(let i=0,r=e.length,n;i<r;i++)(n=e[i])!==s&&(t+=s=n);return t}function filter(e,t){const s=e.length,i=[];for(let r=0,n=0;r<s;r++){const a=e[r];a&&!t[a]&&(i[n++]=a)}return i}function encode(e){return pipeline.call(this,(""+e).toLowerCase(),!1,regex_whitespace,!1)}const global_lang={},global_charset={};function apply_async(e){register$1(e,"add"),register$1(e,"append"),register$1(e,"search"),register$1(e,"update"),register$1(e,"remove")}function register$1(e,t){e[t+"Async"]=function(){const s=this,i=arguments,r=i[i.length-1];let n;is_function(r)&&(n=r,delete i[i.length-1]);const a=new Promise(function(h){setTimeout(function(){s.async=!0;const l=s[t].apply(s,i);s.async=!1,h(l)})});return n?(a.then(n),this):a}}function intersect(e,t,s,i){const r=e.length;let n=[],a,h,l=0;i&&(i=[]);for(let c=r-1;c>=0;c--){const o=e[c],d=o.length,p=create_object();let f=!a;for(let u=0;u<d;u++){const g=o[u],m=g.length;if(m)for(let w=0,_,x;w<m;w++)if(x=g[w],a){if(a[x]){if(!c){if(s)s--;else if(n[l++]=x,l===t)return n}(c||i)&&(p[x]=1),f=!0}if(i&&(_=(h[x]||0)+1,h[x]=_,_<r)){const y=i[_-2]||(i[_-2]=[]);y[y.length]=x}}else p[x]=1}if(i)a||(h=p);else if(!f)return[];a=p}if(i)for(let c=i.length-1,o,d;c>=0;c--){o=i[c],d=o.length;for(let p=0,f;p<d;p++)if(f=o[p],!a[f]){if(s)s--;else if(n[l++]=f,l===t)return n;a[f]=1}}return n}function intersect_union(e,t){const s=create_object(),i=create_object(),r=[];for(let n=0;n<e.length;n++)s[e[n]]=1;for(let n=0,a;n<t.length;n++){a=t[n];for(let h=0,l;h<a.length;h++)l=a[h],s[l]&&(i[l]||(i[l]=1,r[r.length]=l))}return r}function CacheClass(e){this.limit=e!==!0&&e,this.cache=create_object(),this.queue=[]}function searchCache(e,t,s){is_object(e)&&(e=e.query);let i=this.cache.get(e);return i||(i=this.search(e,t,s),this.cache.set(e,i)),i}CacheClass.prototype.set=function(e,t){if(!this.cache[e]){let s=this.queue.length;s===this.limit?delete this.cache[this.queue[s-1]]:s++;for(let i=s-1;i>0;i--)this.queue[i]=this.queue[i-1];this.queue[0]=e}this.cache[e]=t};CacheClass.prototype.get=function(e){const t=this.cache[e];if(this.limit&&t){const s=this.queue.indexOf(e);if(s){const i=this.queue[s-1];this.queue[s-1]=this.queue[s],this.queue[s]=i}}return t};CacheClass.prototype.del=function(e){for(let t=0,s,i;t<this.queue.length;t++)i=this.queue[t],s=this.cache[i],s.includes(e)&&(this.queue.splice(t--,1),delete this.cache[i])};const preset={memory:{charset:"latin:extra",resolution:3,minlength:4,fastupdate:!1},performance:{resolution:3,minlength:3,optimize:!1,context:{depth:2,resolution:1}},match:{charset:"latin:extra",tokenize:"reverse"},score:{charset:"latin:advanced",resolution:20,minlength:3,context:{depth:3,resolution:9}},default:{}};function apply_preset(e){if(is_string(e))e=preset[e];else{const t=e.preset;t&&(e=Object.assign({},t[t],e))}return e}function async(e,t,s,i,r,n,a){setTimeout(function(){const h=e(s?s+"."+i:i,JSON.stringify(a));h&&h.then?h.then(function(){t.export(e,t,s,r,n+1)}):t.export(e,t,s,r,n+1)})}function exportIndex(e,t,s,i,r){let n,a;switch(r||(r=0)){case 0:if(n="reg",this.fastupdate){a=create_object();for(let h in this.register)a[h]=1}else a=this.register;break;case 1:n="cfg",a={doc:0,opt:this.optimize?1:0};break;case 2:n="map",a=this.map;break;case 3:n="ctx",a=this.ctx;break;default:return}return async(e,t||this,s,n,i,r,a),!0}function importIndex(e,t){if(t)switch(is_string(t)&&(t=JSON.parse(t)),e){case"cfg":this.optimize=!!t.opt;break;case"reg":this.fastupdate=!1,this.register=t;break;case"map":this.map=t;break;case"ctx":this.ctx=t;break}}function exportDocument(e,t,s,i,r){if(r||(r=0),i||(i=0),i<this.field.length){const n=this.field[i],a=this.index[n];t=this,setTimeout(function(){a.export(e,t,r?n:"",i,r++)||(i++,r=1,t.export(e,t,n,i,r))})}else{let n,a;switch(r){case 1:n="tag",a=this.tagindex;break;case 2:n="store",a=this.store;break;default:return}async(e,this,s,n,i,r,a)}}function importDocument(e,t){if(t)switch(is_string(t)&&(t=JSON.parse(t)),e){case"tag":this.tagindex=t;break;case"reg":this.fastupdate=!1,this.register=t;for(let i=0,r;i<this.field.length;i++)r=this.index[this.field[i]],r.register=t,r.fastupdate=!1;break;case"store":this.store=t;break;default:e=e.split(".");const s=e[0];e=e[1],s&&e&&this.index[s].import(e,t)}}function handler(e){e=e.data;const t=self._index,s=e.args,i=e.task;switch(i){case"init":const r=e.options||{},n=e.factory,a=r.encode;r.cache=!1,a&&a.indexOf("function")===0&&(r.encode=Function("return "+a)()),n?(Function("return "+n)()(self),self._index=new self.FlexSearch.Index(r),delete self.FlexSearch):self._index=new Index(r);break;default:const h=e.id,l=t[i].apply(t,s);postMessage(i==="search"?{id:h,msg:l}:{id:h})}}let pid=0;function WorkerIndex(e){if(!(this instanceof WorkerIndex))return new WorkerIndex(e);let t;e?is_function(t=e.encode)&&(e.encode=t.toString()):e={};let s=(self||window)._factory;s&&(s=s.toString());const i=typeof window>"u"&&self.exports,r=this;this.worker=create(s,i,e.worker),this.resolver=create_object(),this.worker&&(i?this.worker.on("message",function(n){r.resolver[n.id](n.msg),delete r.resolver[n.id]}):this.worker.onmessage=function(n){n=n.data,r.resolver[n.id](n.msg),delete r.resolver[n.id]},this.worker.postMessage({task:"init",factory:s,options:e}))}register("add");register("append");register("search");register("update");register("remove");function register(e){WorkerIndex.prototype[e]=WorkerIndex.prototype[e+"Async"]=function(){const t=this,s=[].slice.call(arguments),i=s[s.length-1];let r;is_function(i)&&(r=i,s.splice(s.length-1,1));const n=new Promise(function(a){setTimeout(function(){t.resolver[++pid]=a,t.worker.postMessage({task:e,id:pid,args:s})})});return r?(n.then(r),this):n}}function create(factory,is_node_js,worker_path){let worker;try{worker=is_node_js?eval('new (require("worker_threads")["Worker"])("../dist/node/node.js")'):factory?new Worker(URL.createObjectURL(new Blob(["onmessage="+handler.toString()],{type:"text/javascript"}))):new Worker(is_string(worker_path)?worker_path:"worker/worker.js",{type:"module"})}catch(e){}return worker}function Document(e){if(!(this instanceof Document))return new Document(e);const t=e.document||e.doc||e;let s;this.tree=[],this.field=[],this.marker=[],this.register=create_object(),this.key=(s=t.key||t.id)&&parse_tree(s,this.marker)||"id",this.fastupdate=parse_option(e.fastupdate,!0),this.storetree=(s=t.store)&&s!==!0&&[],this.store=s&&create_object(),this.tag=(s=t.tag)&&parse_tree(s,this.marker),this.tagindex=s&&create_object(),this.cache=(s=e.cache)&&new CacheClass(s),e.cache=!1,this.worker=e.worker,this.async=!1,this.index=parse_descriptor.call(this,e,t)}function parse_descriptor(e,t){const s=create_object();let i=t.index||t.field||t;is_string(i)&&(i=[i]);for(let r=0,n,a;r<i.length;r++)n=i[r],is_string(n)||(a=n,n=n.field),a=is_object(a)?Object.assign({},e,a):e,this.worker&&(s[n]=new WorkerIndex(a),s[n].worker||(this.worker=!1)),this.worker||(s[n]=new Index(a,this.register)),this.tree[r]=parse_tree(n,this.marker),this.field[r]=n;if(this.storetree){let r=t.store;is_string(r)&&(r=[r]);for(let n=0;n<r.length;n++)this.storetree[n]=parse_tree(r[n],this.marker)}return s}function parse_tree(e,t){const s=e.split(":");let i=0;for(let r=0;r<s.length;r++)e=s[r],e.indexOf("[]")>=0&&(e=e.substring(0,e.length-2),e&&(t[i]=!0)),e&&(s[i++]=e);return i<s.length&&(s.length=i),i>1?s:s[0]}function parse_simple(e,t){if(is_string(t))e=e[t];else for(let s=0;e&&s<t.length;s++)e=e[t[s]];return e}function store_value(e,t,s,i,r){if(e=e[r],i===s.length-1)t[r]=e;else if(e)if(is_array(e)){t=t[r]=new Array(e.length);for(let n=0;n<e.length;n++)store_value(e,t,s,i,n)}else t=t[r]||(t[r]=create_object()),r=s[++i],store_value(e,t,s,i,r)}function add_index(e,t,s,i,r,n,a,h){if(e=e[a],e)if(i===t.length-1){if(is_array(e)){if(s[i]){for(let l=0;l<e.length;l++)r.add(n,e[l],!0,!0);return}e=e.join(" ")}r.add(n,e,h,!0)}else if(is_array(e))for(let l=0;l<e.length;l++)add_index(e,t,s,i,r,n,l,h);else a=t[++i],add_index(e,t,s,i,r,n,a,h)}Document.prototype.add=function(e,t,s){if(is_object(e)&&(t=e,e=parse_simple(t,this.key)),t&&(e||e===0)){if(!s&&this.register[e])return this.update(e,t);for(let i=0,r,n;i<this.field.length;i++)n=this.field[i],r=this.tree[i],is_string(r)&&(r=[r]),add_index(t,r,this.marker,0,this.index[n],e,r[0],s);if(this.tag){let i=parse_simple(t,this.tag),r=create_object();is_string(i)&&(i=[i]);for(let n=0,a,h;n<i.length;n++)if(a=i[n],!r[a]&&(r[a]=1,h=this.tagindex[a]||(this.tagindex[a]=[]),(!s||!h.includes(e))&&(h[h.length]=e,this.fastupdate))){const l=this.register[e]||(this.register[e]=[]);l[l.length]=h}}if(this.store&&(!s||!this.store[e])){let i;if(this.storetree){i=create_object();for(let r=0,n;r<this.storetree.length;r++)n=this.storetree[r],is_string(n)?i[n]=t[n]:store_value(t,i,n,0,n[0])}this.store[e]=i||t}}return this};Document.prototype.append=function(e,t){return this.add(e,t,!0)};Document.prototype.update=function(e,t){return this.remove(e).add(e,t)};Document.prototype.remove=function(e){if(is_object(e)&&(e=parse_simple(e,this.key)),this.register[e]){for(let t=0;t<this.field.length&&(this.index[this.field[t]].remove(e,!this.worker),!this.fastupdate);t++);if(this.tag&&!this.fastupdate)for(let t in this.tagindex){const s=this.tagindex[t],i=s.indexOf(e);i!==-1&&(s.length>1?s.splice(i,1):delete this.tagindex[t])}this.store&&delete this.store[e],delete this.register[e]}return this};Document.prototype.search=function(e,t,s,i){s||(!t&&is_object(e)?(s=e,e=""):is_object(t)&&(s=t,t=0));let r=[],n=[],a,h,l,c,o,d,p=0;if(s)if(is_array(s))l=s,s=null;else{if(e=s.query||e,a=s.pluck,l=a||s.index||s.field,c=s.tag,h=this.store&&s.enrich,o=s.bool==="and",t=s.limit||t||100,d=s.offset||0,c&&(is_string(c)&&(c=[c]),!e)){for(let u=0,g;u<c.length;u++)g=get_tag.call(this,c[u],t,d,h),g&&(r[r.length]=g,p++);return p?r:[]}is_string(l)&&(l=[l])}l||(l=this.field),o=o&&(l.length>1||c&&c.length>1);const f=!i&&(this.worker||this.async)&&[];for(let u=0,g,m,w;u<l.length;u++){let _;if(m=l[u],is_string(m)||(_=m,m=_.field,e=_.query||e,t=_.limit||t),f){f[u]=this.index[m].searchAsync(e,t,_||s);continue}else i?g=i[u]:g=this.index[m].search(e,t,_||s);if(w=g&&g.length,c&&w){const x=[];let y=0;o&&(x[0]=[g]);for(let S=0,I,b;S<c.length;S++)I=c[S],b=this.tagindex[I],w=b&&b.length,w&&(y++,x[x.length]=o?[b]:b);y&&(o?g=intersect(x,t||100,d||0):g=intersect_union(g,x),w=g.length)}if(w)n[p]=m,r[p++]=g;else if(o)return[]}if(f){const u=this;return new Promise(function(g){Promise.all(f).then(function(m){g(u.search(e,t,s,m))})})}if(!p)return[];if(a&&(!h||!this.store))return r[0];for(let u=0,g;u<n.length;u++){if(g=r[u],g.length&&h&&(g=apply_enrich.call(this,g)),a)return g;r[u]={field:n[u],result:g}}return r};function get_tag(e,t,s,i){let r=this.tagindex[e],n=r&&r.length-s;if(n&&n>0)return(n>t||s)&&(r=r.slice(s,s+t)),i&&(r=apply_enrich.call(this,r)),{tag:e,result:r}}function apply_enrich(e){const t=new Array(e.length);for(let s=0,i;s<e.length;s++)i=e[s],t[s]={id:i,doc:this.store[i]};return t}Document.prototype.contain=function(e){return!!this.register[e]};Document.prototype.get=function(e){return this.store[e]},Document.prototype.set=function(e,t){return this.store[e]=t,this};Document.prototype.searchCache=searchCache;Document.prototype.export=exportDocument,Document.prototype.import=importDocument;apply_async(Document.prototype);function Index(e,t){if(!(this instanceof Index))return new Index(e);let s,i,r;e?(e=apply_preset(e),s=e.charset,i=e.lang,is_string(s)&&(s.indexOf(":")===-1&&(s+=":default"),s=global_charset[s]),is_string(i)&&(i=global_lang[i])):e={};let n,a,h=e.context||{};this.encode=e.encode||s&&s.encode||encode,this.register=t||create_object(),this.resolution=n=e.resolution||9,this.tokenize=r=s&&s.tokenize||e.tokenize||"strict",this.depth=r==="strict"&&h.depth,this.bidirectional=parse_option(h.bidirectional,!0),this.optimize=a=parse_option(e.optimize,!0),this.fastupdate=parse_option(e.fastupdate,!0),this.minlength=e.minlength||1,this.boost=e.boost,this.map=a?create_object_array(n):create_object(),this.resolution_ctx=n=h.resolution||1,this.ctx=a?create_object_array(n):create_object(),this.rtl=s&&s.rtl||e.rtl,this.matcher=(r=e.matcher||i&&i.matcher)&&init_stemmer_or_matcher(r,!1),this.stemmer=(r=e.stemmer||i&&i.stemmer)&&init_stemmer_or_matcher(r,!0),this.filter=(r=e.filter||i&&i.filter)&&init_filter(r),this.cache=(r=e.cache)&&new CacheClass(r)}Index.prototype.append=function(e,t){return this.add(e,t,!0)};Index.prototype.add=function(e,t,s,i){if(t&&(e||e===0)){if(!i&&!s&&this.register[e])return this.update(e,t);t=this.encode(""+t);const r=t.length;if(r){const n=create_object(),a=create_object(),h=this.depth,l=this.resolution;for(let c=0;c<r;c++){let o=t[this.rtl?r-1-c:c],d=o.length;if(o&&d>=this.minlength&&(h||!a[o])){let p=get_score(l,r,c),f="";switch(this.tokenize){case"full":if(d>2){for(let u=0;u<d;u++)for(let g=d;g>u;g--)if(g-u>=this.minlength){const m=get_score(l,r,c,d,u);f=o.substring(u,g),this.push_index(a,f,m,e,s)}break}case"reverse":if(d>1){for(let u=d-1;u>0;u--)if(f=o[u]+f,f.length>=this.minlength){const g=get_score(l,r,c,d,u);this.push_index(a,f,g,e,s)}f=""}case"forward":if(d>1){for(let u=0;u<d;u++)f+=o[u],f.length>=this.minlength&&this.push_index(a,f,p,e,s);break}default:if(this.boost&&(p=Math.min(p/this.boost(t,o,c)|0,l-1)),this.push_index(a,o,p,e,s),h&&r>1&&c<r-1){const u=create_object(),g=this.resolution_ctx,m=o,w=Math.min(h+1,r-c);u[m]=1;for(let _=1;_<w;_++)if(o=t[this.rtl?r-1-c-_:c+_],o&&o.length>=this.minlength&&!u[o]){u[o]=1;const x=get_score(g+(r/2>g?0:1),r,c,w-1,_-1),y=this.bidirectional&&o>m;this.push_index(n,y?m:o,x,e,s,y?o:m)}}}}}this.fastupdate||(this.register[e]=1)}}return this};function get_score(e,t,s,i,r){return s&&e>1?t+(i||0)<=e?s+(r||0):(e-1)/(t+(i||0))*(s+(r||0))+1|0:0}Index.prototype.push_index=function(e,t,s,i,r,n){let a=n?this.ctx:this.map;if((!e[t]||n&&!e[t][n])&&(this.optimize&&(a=a[s]),n?(e=e[t]||(e[t]=create_object()),e[n]=1,a=a[n]||(a[n]=create_object())):e[t]=1,a=a[t]||(a[t]=[]),this.optimize||(a=a[s]||(a[s]=[])),(!r||!a.includes(i))&&(a[a.length]=i,this.fastupdate))){const h=this.register[i]||(this.register[i]=[]);h[h.length]=a}};Index.prototype.search=function(e,t,s){s||(!t&&is_object(e)?(s=e,e=s.query):is_object(t)&&(s=t));let i=[],r,n,a,h=0;if(s&&(e=s.query||e,t=s.limit,h=s.offset||0,n=s.context,a=s.suggest),e&&(e=this.encode(""+e),r=e.length,r>1)){const d=create_object(),p=[];for(let f=0,u=0,g;f<r;f++)if(g=e[f],g&&g.length>=this.minlength&&!d[g]){if(!this.optimize&&!a&&!this.map[g])return i;p[u++]=g,d[g]=1}e=p,r=e.length}if(!r)return i;t||(t=100);let l=this.depth&&r>1&&n!==!1,c=0,o;l?(o=e[0],c=1):r>1&&e.sort(sort_by_length_down);for(let d,p;c<r;c++){if(p=e[c],l?(d=this.add_result(i,a,t,h,r===2,p,o),(!a||d!==!1||!i.length)&&(o=p)):d=this.add_result(i,a,t,h,r===1,p),d)return d;if(a&&c===r-1){let f=i.length;if(f){if(f===1)return single_result(i[0],t,h)}else{if(l){l=0,c=-1;continue}return i}}}return intersect(i,t,h,a)};Index.prototype.add_result=function(e,t,s,i,r,n,a){let h=[],l=a?this.ctx:this.map;if(this.optimize||(l=get_array(l,n,a,this.bidirectional)),l){let c=0;const o=Math.min(l.length,a?this.resolution_ctx:this.resolution);for(let d=0,p=0,f,u;d<o&&(f=l[d],!(f&&(this.optimize&&(f=get_array(f,n,a,this.bidirectional)),i&&f&&r&&(u=f.length,u<=i?(i-=u,f=null):(f=f.slice(i),i=0)),f&&(h[c++]=f,r&&(p+=f.length,p>=s)))));d++);if(c){if(r)return single_result(h,s,0);e[e.length]=h;return}}return!t&&h};function single_result(e,t,s){return e.length===1?e=e[0]:e=concat(e),s||e.length>t?e.slice(s,s+t):e}function get_array(e,t,s,i){if(s){const r=i&&t>s;e=e[r?t:s],e=e&&e[r?s:t]}else e=e[t];return e}Index.prototype.contain=function(e){return!!this.register[e]};Index.prototype.update=function(e,t){return this.remove(e).add(e,t)};Index.prototype.remove=function(e,t){const s=this.register[e];if(s){if(this.fastupdate)for(let i=0,r;i<s.length;i++)r=s[i],r.splice(r.indexOf(e),1);else remove_index(this.map,e,this.resolution,this.optimize),this.depth&&remove_index(this.ctx,e,this.resolution_ctx,this.optimize);t||delete this.register[e],this.cache&&this.cache.del(e)}return this};function remove_index(e,t,s,i,r){let n=0;if(is_array(e))if(r){const a=e.indexOf(t);a!==-1?e.length>1&&(e.splice(a,1),n++):n++}else{r=Math.min(e.length,s);for(let a=0,h;a<r;a++)h=e[a],h&&(n=remove_index(h,t,s,i,r),!i&&!n&&delete e[a])}else for(let a in e)n=remove_index(e[a],t,s,i,r),n||delete e[a];return n}Index.prototype.searchCache=searchCache;Index.prototype.export=exportIndex,Index.prototype.import=importIndex;apply_async(Index.prototype);const cacheBuster=Date.now(),POSTS_JSON=`/blog/posts.json?cb=${cacheBuster}`,SHORTS_JSON=`/blog/shorts.json?cb=${cacheBuster}`,SEARCH_JSON=`/blog/search.json?cb=${cacheBuster}`;class WaymoBlogSearch extends WaymoElement{constructor(){super(...arguments),this.loading=!0,this.allResults=[],this.offset=0,this.query="",this.tagQuery="",this.searchIndex=null}connectedCallback(){this.form=document.querySelector("form[data-search]"),this.searchInput=this.form.elements.namedItem("q"),this.form.addEventListener("submit",t=>{t.preventDefault();const s=this.searchInput.value||"";this.search(s)}),this.init()}async init(){const t=new URLSearchParams(window.location.search);this.query=t.get("q"),this.query&&(this.searchInput.value=this.query),this.tagQuery=t.get("t");const s=t.get("start");if(s){const i=parseInt(s);isNaN(i)||(this.offset=i)}this.searchShorts=t.get("shorts")==="t",window.addEventListener("popstate",()=>{this.init(),this.searchInput.value=this.query}),await this.update()}async search(t){this.query=t;const s=new URL(window.location.toString());s.searchParams.set("q",this.query),s.searchParams.delete("start"),window.location.pathname.includes("search")?(s.searchParams.delete("t"),history.pushState({},"",s),this.offset=0,window.dispatchEvent(new Event("w-search-change")),await this.update()):window.location=`/blog/search/?${s.searchParams.toString()}`}async update(){return this.loading=!0,(this.query||this.tagQuery)&&this.getSlotElement("search-header")?.classList.add("active"),this.searchShorts?this.updateSearchForEntry("blogShort"):this.updateSearchForEntry("blogPost")}async updateSearchForEntry(t){this.allResults.length===0&&(t==="blogPost"?this.allResults=await this.fetchAllPosts():t==="blogShort"&&(this.allResults=await this.fetchAllShorts()));let s=!1,i=0;if(t==="blogPost"){let c;if(this.query||this.tagQuery){this.searchIndex||(this.searchIndex=await this.fetchSearchIndex());let o;this.query?o=this.searchIndex.search(this.query,["title","content"]):o=this.searchIndex.search(this.tagQuery,["tags"]);const d=[];o.forEach(p=>{const f=p.result;d.push(...f)}),c=this.getResultsById(d)}else c=this.allResults;i=c.length,this.offset?c=c.slice(this.offset,PAGE_SIZE+this.offset):c=c.slice(0,PAGE_SIZE),this.renderPosts(c),s=c.length<=0}else if(t==="blogShort"){let c;if(this.query){this.searchIndex||(this.searchIndex=await this.fetchSearchIndex());let o;o=this.searchIndex.search(this.query,["content"]);const d=[];o.forEach(p=>{const f=p.result;d.push(...f)}),c=this.getResultsById(d)}else c=this.allResults;i=c.length,this.offset?c=c.slice(this.offset,PAGE_SIZE+this.offset):c=c?.slice(0,PAGE_SIZE),this.renderShorts(c),s=c?.length<=0}this.loading=!1;const r=!!(this.query||this.tagQuery);this.parentElement.classList.toggle("search:active",r),this.parentElement.classList.toggle("search:empty",s);const n=this.getSlotElement("results-title");if(n){if(this.tagQuery)n.innerText=this.tagQuery;else if(this.query)if(i<=1)n.innerText=`Showing ${i} search results for “${this.query}”`;else{const c=Math.min(this.offset+1,i),o=Math.min(this.offset+PAGE_SIZE,i);n.innerText=`Showing ${c}-${o} of ${i} search results for “${this.query}”`}}const a=Math.ceil(i/PAGE_SIZE);this.parentElement.classList.toggle("search:onepage",a===1);const h={numPages:a,currentOffset:this.offset,query:this.query,tagQuery:this.tagQuery},l=new CustomEvent("w-blog-search-complete",{detail:h,bubbles:!0});if(this.dispatchEvent(l),r){const c=new CustomEvent("w-tracking",{bubbles:!0,detail:{event:"search",page_name:"Search",page_category:"Blog",search_query:this.query||this.tagQuery}});this.dispatchEvent(c)}}renderPosts(t){const s=this.querySelector("ul[data-search-results]");s&&(s.innerHTML="",t.filter(i=>i.title&&i.summary&&i.image).forEach((i,r)=>{const n=document.createElement("w-blog-preview");n.dataset.title=i.title,n.dataset.summary=i.summary,n.dataset.url=i.url,n.dataset.imageSrc=i.image?.src,n.dataset.imageWidth=i.image?.width.toString(),n.dataset.imageHeight=i.image?.height.toString(),n.dataset.imageAlt=i.image?.alt,n.dataset.date=formatBlogPostDate(i.date),n.dataset.author=i.author,n.dataset.type="post",r==0&&(n.dataset.first="true");const a=document.createElement("li");a.appendChild(n),s.appendChild(a)}))}renderShorts(t){const s=this.querySelector("ul[data-search-results]");s&&(s.innerHTML="",t?.filter(i=>i.body&&i.slug&&i.date&&i.author).forEach((i,r)=>{const n=document.createElement("w-blog-preview");n.dataset.body=i.body,n.dataset.url=`/blog#short-${i.slug}`,n.dataset.imageSrc=i.image?.src,n.dataset.imageWidth=i.image?.width.toString(),n.dataset.imageHeight=i.image?.height.toString(),n.dataset.imageAlt=i.image?.alt,n.dataset.video=i.video,n.dataset.date=formatBlogPostDate(i.date),n.dataset.author=i.author,n.dataset.type="short",n.dataset.slug=i.slug,r==0&&(n.dataset.first="true");const a=document.createElement("li");a.appendChild(n),s.appendChild(a)}))}async fetchAllPosts(){return(await(await window.fetch(POSTS_JSON)).json()).posts}async fetchAllShorts(){return(await(await window.fetch(SHORTS_JSON)).json()).shorts}async fetchSearchIndex(){const t=new Document({document:{id:"id",index:["title","content","tags"]}}),i=await(await window.fetch(SEARCH_JSON)).json();for(const[r,n]of Object.entries(i.indexes))t.import(r,n);return t}getResultsById(t){const s=Array(t.length).fill(null);return this.allResults.forEach(i=>{const r=t.findIndex(n=>n===i.id);r>=0&&(s[r]=i)}),s.filter(i=>!!i).sort((i,r)=>{const n=new Date(i.date);return new Date(r.date)-n})}}customElements.get("w-blog-search")||customElements.define("w-blog-search",WaymoBlogSearch);
